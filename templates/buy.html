<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Checkout - SURESH AI ORIGIN</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        .checkout-container {
            max-width: 600px;
            margin: 100px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 0, 110, 0.2);
            border-radius: 25px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
        }
        .product-info {
            text-align: center;
            margin-bottom: 30px;
        }
        .product-name {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #FF006E, #8338EC);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .price-display {
            font-size: 3rem;
            font-weight: 800;
            color: #FF006E;
            margin: 20px 0;
        }
        .features-list {
            list-style: none;
            padding: 0;
            margin: 30px 0;
        }
        .features-list li {
            padding: 10px 0;
            font-size: 1.1rem;
        }
        .pay-button {
            width: 100%;
            padding: 20px;
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #FF006E, #8338EC);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 40px rgba(255, 0, 110, 0.4);
        }
        .pay-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(255, 0, 110, 0.6);
        }
        .security-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            font-size: 0.9rem;
            color: #00FF9F;
        }
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="checkout-container">
        <div class="product-info">
            <h1 class="product-name">{{ product|title }} Pack</h1>
            <div class="price-display" id="priceDisplay">
                â‚¹<span id="finalPrice">99</span>
            </div>
            
            <ul class="features-list" id="featuresList">
                <!-- Dynamically populated by JavaScript -->
            </ul>
        </div>

        <button class="pay-button" id="payButton" onclick="initiatePayment()">
            ðŸ”’ Pay Securely with Razorpay
        </button>

        <div class="loading" id="loading">
            <p>Processing payment...</p>
        </div>

        <div class="security-badges">
            <span>âœ… 256-bit SSL Encryption</span>
            <span>âœ… Secure Payment Gateway</span>
            <span>âœ… Instant Access</span>
        </div>
    </div>

    <script>
        const products = {
            'starter': {
                name: 'Starter Pack',
                price: 99,
                features: [
                    'âœ… 100+ AI Prompts',
                    'âœ… 10+ Automation Workflows',
                    'âœ… Email Support',
                    'âœ… Monthly Updates',
                    'âœ… Lifetime Access'
                ]
            },
            'pro': {
                name: 'Pro Pack',
                price: 499,
                features: [
                    'âœ… 500+ AI Prompts',
                    'âœ… 50+ Automation Workflows',
                    'âœ… Priority Support',
                    'âœ… Private Community',
                    'âœ… Weekly Updates',
                    'âœ… Lifetime Access'
                ]
            },
            'premium': {
                name: 'Premium Pack',
                price: 999,
                features: [
                    'âœ… 1000+ AI Prompts',
                    'âœ… 100+ Automation Workflows',
                    'âœ… 1-on-1 Coaching',
                    'âœ… VIP Community',
                    'âœ… Daily Updates',
                    'âœ… Lifetime Access'
                ]
            }
        };

        const currentProduct = '{{ product }}';
        const productData = products[currentProduct] || products['starter'];

        // Display product info
        document.getElementById('finalPrice').textContent = productData.price;
        const featuresList = document.getElementById('featuresList');
        productData.features.forEach(feature => {
            const li = document.createElement('li');
            li.textContent = feature;
            featuresList.appendChild(li);
        });

        async function initiatePayment() {
            const button = document.getElementById('payButton');
            const loading = document.getElementById('loading');
            
            button.disabled = true;
            button.textContent = 'Processing...';
            loading.style.display = 'block';

            try {
                // Create Razorpay order
                const response = await fetch('/create_order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Idempotency-Key': 'order_' + Date.now() + '_' + Math.random()
                    },
                    body: JSON.stringify({
                        amount: productData.price,
                        product: currentProduct
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to create order');
                }

                const order = await response.json();

                // Initialize Razorpay checkout
                const options = {
                    key: '{{ razorpay_key_id }}',
                    amount: order.amount,
                    currency: order.currency,
                    name: 'SURESH AI ORIGIN',
                    description: productData.name,
                    order_id: order.id,
                    handler: function(response) {
                        // Payment successful - redirect to success page
                        window.location.href = '/success?product=' + currentProduct + '&order_id=' + order.id + '&payment_id=' + response.razorpay_payment_id;
                    },
                    prefill: {
                        name: '',
                        email: '',
                        contact: ''
                    },
                    theme: {
                        color: '#FF006E'
                    },
                    modal: {
                        ondismiss: function() {
                            button.disabled = false;
                            button.textContent = 'ðŸ”’ Pay Securely with Razorpay';
                            loading.style.display = 'none';
                        }
                    }
                };

                const rzp = new Razorpay(options);
                rzp.open();

            } catch (error) {
                console.error('Payment error:', error);
                alert('Failed to initiate payment. Please try again.');
                button.disabled = false;
                button.textContent = 'ðŸ”’ Pay Securely with Razorpay';
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>
